"""initial_schema

Revision ID: e14af2d1360d
Revises: 
Create Date: 2026-02-12 13:25:55.013776+00:00

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql
from pgvector.sqlalchemy import Vector

# revision identifiers, used by Alembic.
revision: str = 'e14af2d1360d'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade database schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('llm_costs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('run_id', sa.String(length=100), nullable=False),
    sa.Column('asset_key', sa.String(length=100), nullable=False),
    sa.Column('partition_key', sa.String(length=100), nullable=True),
    sa.Column('operation', sa.String(length=50), nullable=False),
    sa.Column('model', sa.String(length=100), nullable=False),
    sa.Column('input_tokens', sa.Integer(), nullable=False),
    sa.Column('output_tokens', sa.Integer(), nullable=False),
    sa.Column('cost_usd', sa.Numeric(precision=10, scale=6), nullable=False),
    sa.Column('code_version', sa.String(length=50), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_llm_costs'))
    )
    op.create_table('raw_candidates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('source_id', sa.String(length=255), nullable=True),
    sa.Column('full_name', sa.Text(), nullable=False),
    sa.Column('location_raw', sa.Text(), nullable=True),
    sa.Column('desired_job_categories_raw', sa.Text(), nullable=True),
    sa.Column('skills_raw', sa.Text(), nullable=True),
    sa.Column('cv_url', sa.Text(), nullable=True),
    sa.Column('cv_text', sa.Text(), nullable=True),
    sa.Column('professional_summary', sa.Text(), nullable=True),
    sa.Column('proof_of_work', sa.Text(), nullable=True),
    sa.Column('salary_range_raw', sa.Text(), nullable=True),
    sa.Column('x_profile_url', sa.Text(), nullable=True),
    sa.Column('linkedin_url', sa.Text(), nullable=True),
    sa.Column('earn_profile_url', sa.Text(), nullable=True),
    sa.Column('github_url', sa.Text(), nullable=True),
    sa.Column('work_experience_raw', sa.Text(), nullable=True),
    sa.Column('ingested_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('processing_status', sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='processing_status_enum'), nullable=False),
    sa.Column('processing_error', sa.Text(), nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_raw_candidates')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_raw_candidates_airtable_record_id'))
    )
    op.create_table('raw_jobs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('source_id', sa.String(length=255), nullable=True),
    sa.Column('source_url', sa.Text(), nullable=True),
    sa.Column('job_title', sa.Text(), nullable=True),
    sa.Column('company_name', sa.Text(), nullable=True),
    sa.Column('job_description', sa.Text(), nullable=False),
    sa.Column('company_website_url', sa.Text(), nullable=True),
    sa.Column('experience_level_raw', sa.Text(), nullable=True),
    sa.Column('location_raw', sa.Text(), nullable=True),
    sa.Column('work_setup_raw', sa.Text(), nullable=True),
    sa.Column('status_raw', sa.Text(), nullable=True),
    sa.Column('job_category_raw', sa.Text(), nullable=True),
    sa.Column('x_url', sa.Text(), nullable=True),
    sa.Column('ingested_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('processing_status', sa.Enum('PENDING', 'PROCESSING', 'COMPLETED', 'FAILED', name='processing_status_enum'), nullable=False),
    sa.Column('processing_error', sa.Text(), nullable=True),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_raw_jobs')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_raw_jobs_airtable_record_id'))
    )
    op.create_table('skills',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('name', sa.Text(), nullable=False),
    sa.Column('slug', sa.String(length=100), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('created_by', sa.String(length=50), nullable=False),
    sa.Column('is_active', sa.Boolean(), nullable=False),
    sa.Column('review_status', sa.Enum('PENDING', 'APPROVED', 'REJECTED', name='review_status_enum'), nullable=False),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_skills')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_skills_airtable_record_id')),
    sa.UniqueConstraint('name', name=op.f('uq_skills_name')),
    sa.UniqueConstraint('slug', name=op.f('uq_skills_slug'))
    )
    op.create_table('candidate_vectors',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('vector_type', sa.String(length=50), nullable=False),
    sa.Column('vector', Vector(1536), nullable=False),
    sa.Column('model_version', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['raw_candidates.id'], name=op.f('fk_candidate_vectors_candidate_id_raw_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_vectors'))
    )
    op.create_table('job_vectors',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('job_id', sa.UUID(), nullable=False),
    sa.Column('vector_type', sa.String(length=50), nullable=False),
    sa.Column('vector', Vector(1536), nullable=False),
    sa.Column('model_version', sa.String(length=50), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['job_id'], ['raw_jobs.id'], name=op.f('fk_job_vectors_job_id_raw_jobs'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_job_vectors'))
    )
    op.create_table('normalized_candidates',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('raw_candidate_id', sa.UUID(), nullable=False),
    sa.Column('full_name', sa.Text(), nullable=False),
    sa.Column('email', sa.Text(), nullable=True),
    sa.Column('phone', sa.Text(), nullable=True),
    sa.Column('location_city', sa.Text(), nullable=True),
    sa.Column('location_country', sa.Text(), nullable=True),
    sa.Column('location_region', sa.Text(), nullable=True),
    sa.Column('timezone', sa.String(length=50), nullable=True),
    sa.Column('professional_summary', sa.Text(), nullable=True),
    sa.Column('current_role', sa.Text(), nullable=True),
    sa.Column('seniority_level', sa.Enum('JUNIOR', 'MID', 'SENIOR', 'LEAD', 'PRINCIPAL', 'EXECUTIVE', name='seniority_enum'), nullable=True),
    sa.Column('years_of_experience', sa.Integer(), nullable=True),
    sa.Column('desired_job_categories', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('skills_summary', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('companies_summary', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('notable_achievements', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('verified_communities', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('compensation_min', sa.Integer(), nullable=True),
    sa.Column('compensation_max', sa.Integer(), nullable=True),
    sa.Column('compensation_currency', sa.String(length=10), nullable=False),
    sa.Column('job_count', sa.Integer(), nullable=True),
    sa.Column('job_switches_count', sa.Integer(), nullable=True),
    sa.Column('average_tenure_months', sa.Integer(), nullable=True),
    sa.Column('longest_tenure_months', sa.Integer(), nullable=True),
    sa.Column('education_highest_degree', sa.Text(), nullable=True),
    sa.Column('education_field', sa.Text(), nullable=True),
    sa.Column('education_institution', sa.Text(), nullable=True),
    sa.Column('hackathon_wins_count', sa.Integer(), nullable=False),
    sa.Column('hackathon_total_prize_usd', sa.Integer(), nullable=False),
    sa.Column('solana_hackathon_wins', sa.Integer(), nullable=False),
    sa.Column('x_handle', sa.Text(), nullable=True),
    sa.Column('linkedin_handle', sa.Text(), nullable=True),
    sa.Column('github_handle', sa.Text(), nullable=True),
    sa.Column('social_followers_total', sa.Integer(), nullable=False),
    sa.Column('verification_status', sa.Enum('UNVERIFIED', 'VERIFIED', 'SUSPICIOUS', 'FRAUDULENT', name='verification_status_enum'), nullable=False),
    sa.Column('verification_notes', sa.Text(), nullable=True),
    sa.Column('verified_by', sa.UUID(), nullable=True),
    sa.Column('verified_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('prompt_version', sa.String(length=50), nullable=True),
    sa.Column('model_version', sa.String(length=50), nullable=True),
    sa.Column('normalized_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.ForeignKeyConstraint(['raw_candidate_id'], ['raw_candidates.id'], name=op.f('fk_normalized_candidates_raw_candidate_id_raw_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_normalized_candidates')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_normalized_candidates_airtable_record_id'))
    )
    op.create_table('normalized_jobs',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('raw_job_id', sa.UUID(), nullable=False),
    sa.Column('job_title', sa.Text(), nullable=False),
    sa.Column('job_category', sa.Text(), nullable=True),
    sa.Column('role_type', sa.Text(), nullable=True),
    sa.Column('company_name', sa.Text(), nullable=False),
    sa.Column('company_stage', sa.Enum('STARTUP', 'SCALEUP', 'ENTERPRISE', 'DAO', name='company_stage_enum'), nullable=True),
    sa.Column('company_size', sa.Text(), nullable=True),
    sa.Column('company_website', sa.Text(), nullable=True),
    sa.Column('company_x_url', sa.Text(), nullable=True),
    sa.Column('job_description', sa.Text(), nullable=True),
    sa.Column('role_summary', sa.Text(), nullable=True),
    sa.Column('responsibilities', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('nice_to_haves', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('benefits', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('team_context', sa.Text(), nullable=True),
    sa.Column('seniority_level', sa.Enum('JUNIOR', 'MID', 'SENIOR', 'LEAD', 'PRINCIPAL', 'EXECUTIVE', name='seniority_enum'), nullable=True),
    sa.Column('education_required', sa.Text(), nullable=True),
    sa.Column('domain_experience', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('tech_stack', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('location_type', sa.Enum('REMOTE', 'HYBRID', 'ONSITE', name='location_type_enum'), nullable=True),
    sa.Column('locations', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('timezone_requirements', sa.Text(), nullable=True),
    sa.Column('employment_type', sa.Enum('FULL_TIME', 'PART_TIME', 'CONTRACT', name='employment_type_enum'), nullable=True),
    sa.Column('min_years_experience', sa.Integer(), nullable=True),
    sa.Column('max_years_experience', sa.Integer(), nullable=True),
    sa.Column('salary_min', sa.Integer(), nullable=True),
    sa.Column('salary_max', sa.Integer(), nullable=True),
    sa.Column('salary_currency', sa.String(length=10), nullable=False),
    sa.Column('has_equity', sa.Boolean(), nullable=True),
    sa.Column('equity_details', sa.Text(), nullable=True),
    sa.Column('has_token_compensation', sa.Boolean(), nullable=True),
    sa.Column('min_leadership_score', sa.Integer(), nullable=True),
    sa.Column('min_autonomy_score', sa.Integer(), nullable=True),
    sa.Column('min_technical_depth_score', sa.Integer(), nullable=True),
    sa.Column('min_communication_score', sa.Integer(), nullable=True),
    sa.Column('min_growth_trajectory_score', sa.Integer(), nullable=True),
    sa.Column('status', sa.Enum('ACTIVE', 'PAUSED', 'FILLED', 'CLOSED', name='job_status_enum'), nullable=False),
    sa.Column('priority', sa.Integer(), nullable=False),
    sa.Column('posted_date', sa.Date(), nullable=True),
    sa.Column('deadline_date', sa.Date(), nullable=True),
    sa.Column('is_urgent', sa.Boolean(), nullable=False),
    sa.Column('hiring_manager_name', sa.Text(), nullable=True),
    sa.Column('hiring_manager_email', sa.Text(), nullable=True),
    sa.Column('application_url', sa.Text(), nullable=True),
    sa.Column('prompt_version', sa.String(length=50), nullable=True),
    sa.Column('model_version', sa.String(length=50), nullable=True),
    sa.Column('normalized_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.CheckConstraint('min_autonomy_score IS NULL OR (min_autonomy_score >= 1 AND min_autonomy_score <= 5)', name=op.f('ck_normalized_jobs_ck_job_autonomy_range')),
    sa.CheckConstraint('min_communication_score IS NULL OR (min_communication_score >= 1 AND min_communication_score <= 5)', name=op.f('ck_normalized_jobs_ck_job_communication_range')),
    sa.CheckConstraint('min_growth_trajectory_score IS NULL OR (min_growth_trajectory_score >= 1 AND min_growth_trajectory_score <= 5)', name=op.f('ck_normalized_jobs_ck_job_growth_trajectory_range')),
    sa.CheckConstraint('min_leadership_score IS NULL OR (min_leadership_score >= 1 AND min_leadership_score <= 5)', name=op.f('ck_normalized_jobs_ck_job_leadership_range')),
    sa.CheckConstraint('min_technical_depth_score IS NULL OR (min_technical_depth_score >= 1 AND min_technical_depth_score <= 5)', name=op.f('ck_normalized_jobs_ck_job_technical_depth_range')),
    sa.CheckConstraint('priority >= 1 AND priority <= 4', name=op.f('ck_normalized_jobs_ck_job_priority_range')),
    sa.ForeignKeyConstraint(['raw_job_id'], ['raw_jobs.id'], name=op.f('fk_normalized_jobs_raw_job_id_raw_jobs'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_normalized_jobs')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_normalized_jobs_airtable_record_id'))
    )
    op.create_table('skill_aliases',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('alias', sa.Text(), nullable=False),
    sa.Column('skill_id', sa.UUID(), nullable=False),
    sa.Column('added_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('added_by', sa.String(length=50), nullable=False),
    sa.ForeignKeyConstraint(['skill_id'], ['skills.id'], name=op.f('fk_skill_aliases_skill_id_skills'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_skill_aliases')),
    sa.UniqueConstraint('alias', name=op.f('uq_skill_aliases_alias'))
    )
    op.create_table('candidate_attributes',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('leadership_score', sa.Integer(), nullable=True),
    sa.Column('autonomy_score', sa.Integer(), nullable=True),
    sa.Column('technical_depth_score', sa.Integer(), nullable=True),
    sa.Column('communication_score', sa.Integer(), nullable=True),
    sa.Column('growth_trajectory_score', sa.Integer(), nullable=True),
    sa.Column('reasoning', sa.Text(), nullable=True),
    sa.Column('rated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('rating_model', sa.String(length=50), nullable=True),
    sa.CheckConstraint('autonomy_score IS NULL OR (autonomy_score >= 1 AND autonomy_score <= 5)', name=op.f('ck_candidate_attributes_ck_autonomy_range')),
    sa.CheckConstraint('communication_score IS NULL OR (communication_score >= 1 AND communication_score <= 5)', name=op.f('ck_candidate_attributes_ck_communication_range')),
    sa.CheckConstraint('growth_trajectory_score IS NULL OR (growth_trajectory_score >= 1 AND growth_trajectory_score <= 5)', name=op.f('ck_candidate_attributes_ck_growth_trajectory_range')),
    sa.CheckConstraint('leadership_score IS NULL OR (leadership_score >= 1 AND leadership_score <= 5)', name=op.f('ck_candidate_attributes_ck_leadership_range')),
    sa.CheckConstraint('technical_depth_score IS NULL OR (technical_depth_score >= 1 AND technical_depth_score <= 5)', name=op.f('ck_candidate_attributes_ck_technical_depth_range')),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_attributes_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_attributes')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_attributes_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', name='uq_candidate_attributes')
    )
    op.create_table('candidate_experiences',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('company_name', sa.Text(), nullable=False),
    sa.Column('position_title', sa.Text(), nullable=False),
    sa.Column('start_date', sa.Date(), nullable=True),
    sa.Column('end_date', sa.Date(), nullable=True),
    sa.Column('years_experience', sa.Float(), nullable=True),
    sa.Column('is_current', sa.Boolean(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('skills_used', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('position_order', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_experiences_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_experiences')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_experiences_airtable_record_id'))
    )
    op.create_table('candidate_github_metrics',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('github_username', sa.Text(), nullable=False),
    sa.Column('github_url', sa.Text(), nullable=True),
    sa.Column('public_repos', sa.Integer(), nullable=False),
    sa.Column('total_stars', sa.Integer(), nullable=False),
    sa.Column('followers', sa.Integer(), nullable=False),
    sa.Column('languages', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('fetched_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_github_metrics_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_github_metrics')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_github_metrics_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', name='uq_candidate_github')
    )
    op.create_table('candidate_linkedin_metrics',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('linkedin_username', sa.Text(), nullable=False),
    sa.Column('linkedin_url', sa.Text(), nullable=True),
    sa.Column('followers_count', sa.Integer(), nullable=True),
    sa.Column('connections_count', sa.Integer(), nullable=True),
    sa.Column('headline', sa.Text(), nullable=True),
    sa.Column('source', sa.String(length=50), nullable=False),
    sa.Column('fetched_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_linkedin_metrics_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_linkedin_metrics')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_linkedin_metrics_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', name='uq_candidate_linkedin')
    )
    op.create_table('candidate_projects',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('project_name', sa.Text(), nullable=False),
    sa.Column('description', sa.Text(), nullable=True),
    sa.Column('url', sa.Text(), nullable=True),
    sa.Column('technologies', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('is_hackathon', sa.Boolean(), nullable=False),
    sa.Column('hackathon_name', sa.Text(), nullable=True),
    sa.Column('prize_won', sa.Text(), nullable=True),
    sa.Column('prize_amount_usd', sa.Integer(), nullable=True),
    sa.Column('year', sa.Integer(), nullable=True),
    sa.Column('start_date', sa.Date(), nullable=True),
    sa.Column('end_date', sa.Date(), nullable=True),
    sa.Column('project_order', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_projects_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_projects')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_projects_airtable_record_id'))
    )
    op.create_table('candidate_role_fitness',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('role_name', sa.Text(), nullable=False),
    sa.Column('fitness_score', sa.Float(), nullable=False),
    sa.Column('score_breakdown', sa.Text(), nullable=True),
    sa.Column('computed_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('algorithm_version', sa.String(length=50), nullable=True),
    sa.CheckConstraint('fitness_score >= 0 AND fitness_score <= 1', name=op.f('ck_candidate_role_fitness_ck_fitness_range')),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_role_fitness_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_role_fitness')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_role_fitness_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', 'role_name', name='uq_candidate_role')
    )
    op.create_table('candidate_skills',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('skill_id', sa.UUID(), nullable=False),
    sa.Column('rating', sa.Integer(), nullable=False),
    sa.Column('years_experience', sa.Integer(), nullable=True),
    sa.Column('notable_achievement', sa.Text(), nullable=True),
    sa.Column('rated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('rating_model', sa.String(length=50), nullable=True),
    sa.CheckConstraint('rating >= 1 AND rating <= 5', name=op.f('ck_candidate_skills_ck_rating_range')),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_skills_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['skill_id'], ['skills.id'], name=op.f('fk_candidate_skills_skill_id_skills'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_skills')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_skills_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', 'skill_id', name='uq_candidate_skill')
    )
    op.create_table('candidate_twitter_metrics',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('twitter_username', sa.Text(), nullable=False),
    sa.Column('twitter_url', sa.Text(), nullable=True),
    sa.Column('followers_count', sa.Integer(), nullable=False),
    sa.Column('following_count', sa.Integer(), nullable=False),
    sa.Column('tweet_count', sa.Integer(), nullable=False),
    sa.Column('listed_count', sa.Integer(), nullable=False),
    sa.Column('fetched_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_candidate_twitter_metrics_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_candidate_twitter_metrics')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_candidate_twitter_metrics_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', name='uq_candidate_twitter')
    )
    op.create_table('job_required_skills',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('job_id', sa.UUID(), nullable=False),
    sa.Column('skill_id', sa.UUID(), nullable=False),
    sa.Column('requirement_type', sa.Enum('MUST_HAVE', 'NICE_TO_HAVE', name='requirement_type_enum'), nullable=False),
    sa.Column('min_years', sa.Integer(), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint('min_years IS NULL OR min_years >= 0', name=op.f('ck_job_required_skills_ck_min_years_positive')),
    sa.ForeignKeyConstraint(['job_id'], ['normalized_jobs.id'], name=op.f('fk_job_required_skills_job_id_normalized_jobs'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['skill_id'], ['skills.id'], name=op.f('fk_job_required_skills_skill_id_skills'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_job_required_skills')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_job_required_skills_airtable_record_id')),
    sa.UniqueConstraint('job_id', 'skill_id', name='uq_job_skill')
    )
    op.create_table('matches',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('airtable_record_id', sa.String(length=255), nullable=True),
    sa.Column('candidate_id', sa.UUID(), nullable=False),
    sa.Column('job_id', sa.UUID(), nullable=False),
    sa.Column('match_score', sa.Float(), nullable=False),
    sa.Column('rank', sa.Integer(), nullable=True),
    sa.Column('skills_match_score', sa.Float(), nullable=True),
    sa.Column('experience_match_score', sa.Float(), nullable=True),
    sa.Column('compensation_match_score', sa.Float(), nullable=True),
    sa.Column('location_match_score', sa.Float(), nullable=True),
    sa.Column('matching_skills', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('missing_skills', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('match_reasoning', sa.Text(), nullable=True),
    sa.Column('red_flags', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('strengths', postgresql.ARRAY(sa.Text()), nullable=True),
    sa.Column('status', sa.Enum('MATCHED', 'REVIEWED', 'CONTACTED', 'REJECTED', 'HIRED', name='match_status_enum'), nullable=False),
    sa.Column('reviewer_notes', sa.Text(), nullable=True),
    sa.Column('reviewed_by', sa.UUID(), nullable=True),
    sa.Column('reviewed_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('matched_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('algorithm_version', sa.String(length=50), nullable=True),
    sa.CheckConstraint('match_score >= 0 AND match_score <= 1', name=op.f('ck_matches_ck_match_score_range')),
    sa.ForeignKeyConstraint(['candidate_id'], ['normalized_candidates.id'], name=op.f('fk_matches_candidate_id_normalized_candidates'), ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['job_id'], ['normalized_jobs.id'], name=op.f('fk_matches_job_id_normalized_jobs'), ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id', name=op.f('pk_matches')),
    sa.UniqueConstraint('airtable_record_id', name=op.f('uq_matches_airtable_record_id')),
    sa.UniqueConstraint('candidate_id', 'job_id', name='uq_candidate_job')
    )
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade database schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('matches')
    op.drop_table('job_required_skills')
    op.drop_table('candidate_twitter_metrics')
    op.drop_table('candidate_skills')
    op.drop_table('candidate_role_fitness')
    op.drop_table('candidate_projects')
    op.drop_table('candidate_linkedin_metrics')
    op.drop_table('candidate_github_metrics')
    op.drop_table('candidate_experiences')
    op.drop_table('candidate_attributes')
    op.drop_table('skill_aliases')
    op.drop_table('normalized_jobs')
    op.drop_table('normalized_candidates')
    op.drop_table('job_vectors')
    op.drop_table('candidate_vectors')
    op.drop_table('skills')
    op.drop_table('raw_jobs')
    op.drop_table('raw_candidates')
    op.drop_table('llm_costs')
    # ### end Alembic commands ###
